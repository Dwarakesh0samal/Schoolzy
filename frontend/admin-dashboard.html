<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Add School</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .admin-form-container {
      max-width: 480px;
      margin: 3rem auto;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 16px rgba(80,80,120,0.10);
      padding: 2rem 2.5rem;
    }
    .admin-form-container h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .admin-form label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 500;
    }
    .admin-form input {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 1.1rem;
      border-radius: 7px;
      border: 1.5px solid #e2e8f0;
      font-size: 1rem;
      background: #f8fafc;
    }
    .admin-form button {
      width: 100%;
      padding: 0.8rem;
      border-radius: 7px;
      background: #667eea;
      color: #fff;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .admin-form button:disabled {
      background: #b3b3b3;
      cursor: not-allowed;
    }
    .admin-message {
      text-align: center;
      margin-bottom: 1.2rem;
      color: #e53e3e;
      font-weight: 500;
    }
    .admin-success {
      color: #38a169;
    }
  </style>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="admin-form-container">
    <h2>Add New School</h2>
    <div id="admin-message" class="admin-message"></div>
    <form id="add-school-form" class="admin-form" style="display:none;">
      <label for="school-name">School Name</label>
      <input type="text" id="school-name" required>
      <label for="school-city">City</label>
      <input type="text" id="school-city" required>
      <label for="school-fee">Fee</label>
      <input type="number" id="school-fee" min="0" required>
      <label for="school-phone">Phone</label>
      <input type="text" id="school-phone" required>
      <label for="school-lat">Latitude</label>
      <input type="number" id="school-lat" step="any" required>
      <label for="school-lng">Longitude</label>
      <input type="number" id="school-lng" step="any" required>
      <button type="submit" id="submit-btn">Add School</button>
    </form>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDtDvdCi-sxXwZaJJfJkgs29_7QzXiivM8",
      authDomain: "schoolzy-c28c5.firebaseapp.com",
      projectId: "schoolzy-c28c5",
      storageBucket: "schoolzy-c28c5.firebasestorage.app",
      messagingSenderId: "229767328669",
      appId: "1:229767328669:web:8beae1876e475df6213574",
      measurementId: "G-SNE5MBVK1C"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const adminMessage = document.getElementById('admin-message');
    const addSchoolForm = document.getElementById('add-school-form');
    const submitBtn = document.getElementById('submit-btn');

    // Check admin access
    auth.onAuthStateChanged(async user => {
      if (!user) {
        adminMessage.textContent = 'Please log in as an admin to access this page.';
        addSchoolForm.style.display = 'none';
        return;
      }
      // Get user role from Firestore
      try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (userDoc.exists && userDoc.data().role === 'admin') {
          adminMessage.textContent = '';
          addSchoolForm.style.display = 'block';
        } else {
          adminMessage.textContent = 'Access denied. You are not an admin.';
          addSchoolForm.style.display = 'none';
        }
      } catch (err) {
        adminMessage.textContent = 'Error checking admin status.';
        addSchoolForm.style.display = 'none';
      }
    });

    // Add school to Firestore
    addSchoolForm.onsubmit = async function(e) {
      e.preventDefault();
      submitBtn.disabled = true;
      adminMessage.textContent = '';
      const name = document.getElementById('school-name').value.trim();
      const city = document.getElementById('school-city').value.trim();
      const fee = parseInt(document.getElementById('school-fee').value, 10);
      const phone = document.getElementById('school-phone').value.trim();
      const latitude = parseFloat(document.getElementById('school-lat').value);
      const longitude = parseFloat(document.getElementById('school-lng').value);
      try {
        await db.collection('schools').add({
          name,
          city,
          fee,
          phone,
          latitude,
          longitude,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        adminMessage.textContent = 'School added successfully!';
        adminMessage.classList.add('admin-success');
        addSchoolForm.reset();
      } catch (err) {
        adminMessage.textContent = 'Error adding school: ' + err.message;
        adminMessage.classList.remove('admin-success');
      }
      submitBtn.disabled = false;
    };
  </script>
</body>
</html> 